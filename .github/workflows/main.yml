name: Linux-RDP-Fast
on: 
  workflow_dispatch:

jobs:
  secure-rdp:
    runs-on: ubuntu-latest
    timeout-minutes: 3600

    steps:
      - name: Fast GUI Install
        run: |
          sudo apt-get update
          # Sirf zaroori files install kar rahe hain taaki time bache
          sudo apt-get install -y --no-install-recommends xfce4 xfce4-session xrdp firefox-esr
          echo "xfce4-session" > ~/.xsession
          sudo systemctl enable xrdp
          sudo systemctl start xrdp

      - name: Setup User
        run: |
          # Mobile friendly password setup
          PASSWORD="Pass${{ github.run_id }}"
          sudo useradd -m RDP -s /bin/bash
          echo "RDP:$PASSWORD" | sudo chpasswd
          sudo usermod -aG sudo RDP
          echo "RDP_PASS=$PASSWORD" >> $GITHUB_ENV

      - name: Tailscale Connect (FIXED)
        run: |
          curl -fsSL https://tailscale.com/install.sh | sh
          # Hostname fix: Linux mein $GITHUB_RUN_ID use hota hai
          sudo tailscale up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} --hostname=gh-linux-${{ github.run_id }}
          echo "TAILSCALE_IP=$(tailscale ip -4)" >> $GITHUB_ENV

      - name: Final Access Details
        run: |
          echo -e "\n=== ACCESS DETAILS ==="
          echo "IP Address: $TAILSCALE_IP"
          echo "Username: RDP"
          echo "Password: $RDP_PASS"
          echo "======================\n"
          # Runner active rakhne ke liye
          while true; do sleep 300; done
