name: Master-Linux-RDP
on: workflow_dispatch

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Install Desktop (Fast & Stable)
        run: |
          sudo apt update
          # dbus-x11 aur xfce4-session black screen ko khatam karte hain
          sudo DEBIAN_FRONTEND=noninteractive apt install -y xfce4 xfce4-goodies xrdp dbus-x11 firefox
          
          # XRDP Configuration (Simple & Working)
          sudo adduser xrdp ssl-cert
          echo "xfce4-session" > ~/.xsession
          sudo systemctl enable xrdp
          sudo systemctl start xrdp

      - name: Setup User
        run: |
          # Mobile user ke liye aasaan password
          PASSWORD="Pass${{ github.run_id }}"
          sudo useradd -m RDP -s /bin/bash
          echo "RDP:$PASSWORD" | sudo chpasswd
          sudo usermod -aG sudo RDP
          echo "RDP_PASS=$PASSWORD" >> $GITHUB_ENV

      - name: Tailscale Connection
        run: |
          curl -fsSL https://tailscale.com/install.sh | sh
          # Agar Secret mein Auth Key hai toh turant connect hoga
          sudo tailscale up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} --hostname=gh-linux-${{ github.run_id }} || sudo tailscale up --hostname=gh-linux-${{ github.run_id }}

      - name: Access Details
        run: |
          echo -e "\n=== üñ•Ô∏è RDP READY HAI! ==="
          echo "Username: RDP"
          echo "Password: $RDP_PASS"
          echo "IP: Check in Tailscale App/Dashboard"
          echo "=========================\n"
          # 6 ghante tak active rakhne ke liye
          while true; do sleep 300; done
